@startuml Blackjack

title ブラックジャックゲーム全体の流れ

skinparam responseMessageBelowArrow true
skinparam actorStyle awesome

participant Main order 10
participant Game order 20
participant Message order 30
actor Dealer order 40
actor "<<Manual>>\nPlayer" as mp order 50 #AliceBlue
actor "<<Auto>>\nPlayer" as ap order 60 #LavenderBlush
participant Deck order 70
participant Card order 80

Main -> Game : Game を new する

group #LightGoldenRodYellow Game を new する
  activate Game
  Game ->  Dealer : Dealer を new する
  activate  Dealer
  Game -> Deck : Deck を new する
  activate Deck
  Deck -> Card : カード52枚を取得する
  activate Card
  Card --> Deck : カード52枚を返却する
  deactivate Card

  Game -> mp : Player を new する
  activate mp #AliceBlue
end

Main -> Game : ブラックジャックを\n開始する

group #LightGoldenRodYellow ゲームの設定をする
  Game -> Message : プレイヤー数を決める(メッセージ表示)
  note over Message
  ブラックジャックの設定をします。
  プレイヤーの人数を入力してください。（1〜3）
  🙋‍ 2
  プレイヤー2名でゲームを開始します。
  end note

  Game -> ap : 決めた人数の NPC を new する
  activate ap #LavenderBlush
end

group #LightGoldenRodYellow ベットする額を決める
  Game -> Message : ベットする額を決める(メッセージ表示)
  note over Message
  あなたの持っているチップは100ドルです。
  ベットする額を入力してください。（1〜1000ドル）
  💲 10
  10ドルをベットしました。
  end note
  Game -> mp : Player の ベットする額 を決めた額に変更する
end

ref over Game
  別添「１ゲームの流れ」
  ・ゲームを開始する
  ・ゲームを進行する
  ・結果を判定する
end ref

group #LightGoldenRodYellow チップを計算する
    Game -> Dealer : ディーラーはチップを計算する
    Dealer -> mp : Player の合計チップ数を変更する

    alt 勝った人（ステータス → win）
      Dealer ->  Message : メッセージを表示する
      note over Message #Yellow
        勝ったので 5 チップと同額の配当を得られます。
        あなたのチップ残高は 105 ドルです。
      end note

    else 負けた人（ステータス → lose）
      Dealer ->  Message : メッセージを表示する
      note over Message #Yellow
        負けたため、チップ 5 ドルは没収されます。
        あなたのチップ残高は 95 ドルです。
      end note
    else 引き分けた人（ステータス → draw）
      Dealer ->  Message : メッセージを表示する
      note over Message #Yellow
        引き分けたため、チップ 5 ドルはそのままです。
        あなたのチップ残高は 100 ドルです。
      end note
    end
end

group #LightGoldenRodYellow ゲームを続けるか、やめるかを選択する

    alt チップ残高がある場合
      Game ->  Message : メッセージを表示する
      note over Message #Yellow
        ブラックジャックゲームを続けますか？（Y/N）
      end note
    else チップ残高が 0 の場合
      Game ->  Message : メッセージを表示する
      note over Message #Yellow
        あなたは、チップの残高がなくなりました。
      end note
    end
end
alt ゲーム続行
  note over Game
    次のゲームへ
    （「ベットする額を決める」まで戻る）
  end note
else ゲーム終了
  Game --> Main : ゲーム終了
end
  deactivate Dealer
  deactivate mp
  deactivate ap
  deactivate Deck
deactivate Game
@enduml
